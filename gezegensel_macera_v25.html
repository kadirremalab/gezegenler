<!DOCTYPE html>
<html>
<head>
<title>Yer Çekimsiz Gezegen Macerası (V45 - Hata Giderildi)</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
  /* Genel Stil ve Geçişler */
  body {
    overflow: hidden;
    background-color: #34495e;
    font-family: Arial, sans-serif;
    margin: 0;
    transition: background-color 1s ease, background-image 1s ease;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  #startScreen h1, #endScreen h1, #pauseScreen h1, #scoreboard { font-family: 'Press Start 2P', cursive; }
  #startScreen h1 { font-size: 2.5em; color: #3498db; text-shadow: 0 0 10px rgba(52, 152, 219, 0.8), 2px 2px 0 #000; }
  #startScreen p { font-family: 'Press Start 2P', cursive; font-size: 0.7em; color: #ecf0f1; text-shadow: 1px 1px 0 #000; max-width: 80%; line-height: 1.5; }
  #gameContainer { position: relative; width: 100vw; height: 100vh; overflow: hidden; cursor: default; }

  /* Oyuncu Stili (Alev Topu) */
  #player {
    width: 40px; height: 40px; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%); z-index: 50;
    background: radial-gradient(circle at 50% 50%, #ffcc00 0%, #ff6600 50%, #cc0000 100%);
    border-radius: 50%;
    box-shadow: 0 0 15px 5px rgba(255, 102, 0, 0.7), 0 0 30px 10px rgba(255, 0, 0, 0.5);
    animation: flamePulse 1.5s infinite alternate;
  }
  @keyframes flamePulse {
    0% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.05); }
    100% { transform: translate(-50%, -50%) scale(1); }
  }

  /* Engel Stilleri */
  .obstacle-row { position: absolute; bottom: -30px; left: 0; width: 100%; display: flex; align-items: center; z-index: 40; height: 30px; }
  .obstacle-segment { height: 100%; box-shadow: 0 0 8px rgba(0, 0, 0, 0.5); border-radius: 5px; }
  .obstacle-gap { background-color: transparent; height: 100%; }

  /* Güçlendirme Stili */
  #powerup {
    position: absolute; width: 25px; height: 25px; border-radius: 50%;
    background: radial-gradient(circle, #3498db 0%, #2ecc71 100%);
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.9); z-index: 60;
    animation: spin 3s linear infinite; cursor: pointer;
  }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  .slow-motion-body { filter: blur(2px) brightness(80%); }

  /* Bilgi Kutuları ve Ekranlar */
  .info-box { position: absolute; padding: 10px; background-color: rgba(0, 0, 0, 0.5); color: white; border-radius: 5px; z-index: 100; font-family: 'Press Start 2P', cursive; font-size: 0.8em; }
  #scoreboard { top: 10px; left: 10px; }
  #timer { top: 10px; right: 10px; }
  .screen-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; z-index: 1000; }
  .hidden { display: none !important; }

  /* Buton ve Input Stilleri */
  #usernameInput, #endUsernameInput { padding: 12px 20px; margin: 15px 0; border: 2px solid #3498db; border-radius: 8px; font-size: 1.2em; text-align: center; background-color: rgba(255, 255, 255, 0.9); color: #333; transition: all 0.3s; width: 250px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); }
  .btn { padding: 15px 30px; margin-top: 20px; font-size: 20px; cursor: pointer; border: none; border-radius: 5px; background-color: #2ecc71; color: white; transition: background-color 0.3s; font-family: 'Press Start 2P', cursive; font-size: 0.8em; }
  .btn:hover { background-color: #27ae60; }
  #endScreen .btn, #confirmScoreBtn { background-color: #e74c3c; }
  #endScreen .btn:hover, #confirmScoreBtn:hover { background-color: #c0392b; }
  #endScreen h1 { font-size: 4em; color: #e74c3c; text-shadow: 0 0 15px rgba(231, 76, 60, 0.8), 3px 3px 0 #000; }
  #pauseScreen .btn { background-color: #3498db; }
  #pauseScreen .btn:hover { background-color: #2980b9; }
</style>
</head>
<body>

<div id="gameContainer">
    <div id="startScreen" class="screen-overlay">
        <h1>GEZEGENSEL MACERA</h1>
        <p>Kural: Tam serbest hareket ile boşluklardan geçin.</p>
        <p>Kontroller: Oklar / WASD ile 8 yöne hareket.</p>
        
        <label for="usernameInput" style="font-size: 1.2em; margin-top: 10px; color: #f1c40f;">Kullanıcı Adınız:</label>
        <input type="text" id="usernameInput" placeholder="Adınızı Girin" maxlength="15" value="Anonim">
        
        <button id="startButton" class="btn">Oyunu Başlat</button>
    </div>

    <div id="endScreen" class="screen-overlay hidden">
        <h1>OYUN BİTTİ!</h1>
        <h2>Final Skorunuz: <span id="finalScore">0</span></h2>
        <p>Oynama Süresi: <span id="finalTime">00:00</span></p>
        
        <div id="scoreEntry" style="margin-top: 20px;">
             <label for="endUsernameInput" style="font-size: 1.2em; margin-top: 10px;">Skoru Kaydet:</label>
             <input type="text" id="endUsernameInput" placeholder="Adınızı Girin" maxlength="15">
             <button id="confirmScoreBtn" class="btn">Skoru Kaydet & Tabloyu Göster</button>
        </div>
        
        <h3>Top 10 Skor Tablosu</h3>
        <ul id="leaderboardList"></ul>

        <button id="restartButton" class="btn">Tekrar Oyna</button>
    </div>

    <div id="pauseScreen" class="screen-overlay hidden">
        <h1>DURAKLATILDI</h1>
        <p>Devam etmek için **SPACE**, **P** veya **ESC** tuşuna basın.</p>
        <button id="resumeButton" class="btn">Devam Et</button>
    </div>

    <div id="scoreboard" class="info-box hidden"></div>
    <div id="timer" class="info-box hidden">Süre: <span id="timeValue">00:00</span></div>
    
    <div id="player"></div>
    <div id="powerup" class="hidden"></div> 
</div>

<script>
  // V45: Hata veren '.catch()' metodları kaldırıldı. Ses nesneleri çalışmazsa bile oyun devam eder.
  const scoreSound = { play: () => {} };
  const collisionSound = { play: () => {} };
  
  const body = document.body;
  const gameContainer = document.getElementById('gameContainer');
  const player = document.getElementById('player');
  const leaderboardList = document.getElementById('leaderboardList'); 
  const powerupElement = document.getElementById('powerup'); 
  const startScreen = document.getElementById('startScreen');
  const endScreen = document.getElementById('endScreen');
  const pauseScreen = document.getElementById('pauseScreen'); 
  const usernameInput = document.getElementById('usernameInput'); 
  const endUsernameInput = document.getElementById('endUsernameInput'); 
  const confirmScoreBtn = document.getElementById('confirmScoreBtn'); 
  
  // --- Sabitler ---
  const playerSize =
