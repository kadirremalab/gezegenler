<!DOCTYPE html>
<html>
<head>
<title>Yer Çekimsiz Gezegen Macerası (V48 - TAM STABİL)</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
    /* 1. ARKA PLAN VE GENEL STİLLER */
    body {
        overflow: hidden;
        background-color: #34495e; 
        font-family: Arial, sans-serif;
        margin: 0;
        /* Görsel geçişi için süre tanır */
        transition: background-image 1s ease, filter 0.5s ease;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }
    #startScreen h1, #endScreen h1, #pauseScreen h1, #scoreboard { font-family: 'Press Start 2P', cursive; }
    #gameContainer { position: relative; width: 100vw; height: 100vh; overflow: hidden; cursor: default; }
    .screen-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; z-index: 1000; }
    .hidden { display: none !important; }

    /* 2. OYUNCU STİLİ */
    #player {
        width: 40px; height: 40px; position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%); z-index: 50;
        background: radial-gradient(circle at 50% 50%, #ffcc00 0%, #ff6600 50%, #cc0000 100%);
        border-radius: 50%;
        box-shadow: 0 0 15px 5px rgba(255, 102, 0, 0.7), 0 0 30px 10px rgba(255, 0, 0, 0.5);
        animation: flamePulse 1.5s infinite alternate;
    }
    @keyframes flamePulse { 0% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.05); } 100% { transform: translate(-50%, -50%) scale(1); } }

    /* 3. ENGEL STİLLERİ */
    .obstacle-row { position: absolute; bottom: -30px; left: 0; width: 100%; display: flex; align-items: center; z-index: 40; height: 30px; }
    .obstacle-segment { 
        height: 100%; 
        background: radial-gradient(circle at 50% 50%, #f7f7f7 0%, #5D6D7E 100%); 
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.5); border-radius: 5px; 
        transition: background-color 0.5s ease; /* Tema değişiminde yumuşak geçiş */
    }
    .obstacle-gap { background-color: transparent; height: 100%; }

    /* 4. ARAYÜZ VE BUTON STİLLERİ */
    .info-box { position: absolute; padding: 10px; background-color: rgba(0, 0, 0, 0.7); color: white; border-radius: 5px; z-index: 100; font-family: 'Press Start 2P', cursive; font-size: 0.8em; }
    #scoreboard { top: 10px; left: 10px; }
    #timer { top: 10px; right: 10px; }
    
    .btn { padding: 15px 30px; margin-top: 20px; font-size: 20px; cursor: pointer; border: none; border-radius: 5px; background-color: #2ecc71; color: white; transition: background-color 0.3s; font-family: 'Press Start 2P', cursive; font-size: 0.8em; }
    .btn:hover { background-color: #27ae60; }
    #usernameInput, #endUsernameInput { padding: 12px 20px; margin: 15px 0; border: 2px solid #3498db; border-radius: 8px; font-size: 1.2em; text-align: center; background-color: rgba(255, 255, 255, 0.9); color: #333; transition: all 0.3s; width: 250px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); }
    
    /* GÜÇLENDİRME STİLİ */
    #powerup { position: absolute; width: 25px; height: 25px; border-radius: 50%; background: radial-gradient(circle, #3498db 0%, #2ecc71 100%); box-shadow: 0 0 10px rgba(52, 152, 219, 0.9); z-index: 60; animation: spin 3s linear infinite; cursor: pointer; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .slow-motion-body { filter: blur(2px) brightness(80%); }
    
</style>
</head>
<body>

<div id="gameContainer">
    <div id="startScreen" class="screen-overlay">
        <h1>GEZEGENSEL MACERA</h1>
        <p>Kural: Tam serbest hareket ile boşluklardan geçin.</p>
        <p>Kontroller: Oklar / WASD ile 8 yöne hareket.</p>
        
        <label for="usernameInput" style="font-size: 1.2em; margin-top: 10px; color: #f1c40f;">Kullanıcı Adınız:</label>
        <input type="text" id="usernameInput" placeholder="Adınızı Girin" maxlength="15" value="Anonim">
        
        <button id="startButton" class="btn">Oyunu Başlat</button>
    </div>

    <div id="endScreen" class="screen-overlay hidden">
        <h1>OYUN BİTTİ!</h1>
        <h2>Final Skorunuz: <span id="finalScore">0</span></h2>
        <p>Oynama Süresi: <span id="finalTime">00:00</span></p>
        
        <div id="scoreEntry" style="margin-top: 20px;">
             <label for="endUsernameInput" style="font-size: 1.2em; margin-top: 10px;">Skoru Kaydet:</label>
             <input type="text" id="endUsernameInput" placeholder="Adınızı Girin" maxlength="15">
             <button id="confirmScoreBtn" class="btn" style="background-color: #e74c3c;">Skoru Kaydet & Tabloyu Göster</button>
        </div>
        
        <h3>Top 10 Skor Tablosu</h3>
        <ul id="leaderboardList" style="list-style: none; padding: 0;"></ul>

        <button id="restartButton" class="btn" style="background-color: #3498db;">Tekrar Oyna</button>
    </div>

    <div id="pauseScreen" class="screen-overlay hidden">
        <h1>DURAKLATILDI</h1>
        <p>Devam etmek için **SPACE**, **P** veya **ESC** tuşuna basın.</p>
        <button id="resumeButton" class="btn" style="background-color: #3498db;">Devam Et</button>
    </div>

    <div id="scoreboard" class="info-box hidden"></div>
    <div id="timer" class="info-box hidden">Süre: <span id="timeValue">00:00</span></div>
    
    <div id="player"></div>
    <div id="powerup" class="hidden"></div> 
</div>

<script>
    // ----------------------------------------------------------------------
    // V48 - GÖRSEL VE SES DOSYASI YOLLARI
    // ----------------------------------------------------------------------

    // BASE_URL = './' AYARI SAYESİNDE, DOSYALARIN HTML İLE AYNI KLASÖRDE OLMASI GEREKİR.
    const BASE_URL = './'; 
    
    // GÖRSEL DOSYALARININ UZANTISI (.jpeg, .png, vb.)
    const IMAGE_EXTENSION = '.jpeg'; 
    
    // SES DOSYALARINI YÜKLE - Buradaki isimler kesinlikle doğru olmalı!
    try {
        var scoreSound = new Audio(BASE_URL + 'score_sound.mp3');
        var collisionSound = new Audio(BASE_URL + 'collision_sound.mp3');
        var powerupSound = new Audio(BASE_URL + 'powerup_sound.mp3');
    } catch (e) {
        console.error("Ses dosyaları yüklenemedi. Sanal ses nesneleri kullanılıyor.");
        // Yükleme başarısız olursa, hatayı önlemek için sahte nesneler kullanırız.
        var scoreSound = { play: () => {} };
        var collisionSound = { play: () => {} };
        var powerupSound = { play: () => {} };
    }
    
    function playScoreSound() { scoreSound.play(); }
    function playCollisionSound() { collisionSound.play(); }
    function playPowerupSound() { powerupSound.play(); }

    // --- DOM ve Sabit Tanımlar ---
    const body = document.body;
    const gameContainer = document.getElementById('gameContainer');
    const player = document.getElementById('player');
    const leaderboardList = document.getElementById('leaderboardList'); 
    const powerupElement = document.getElementById('powerup'); 
    const startScreen = document.getElementById('startScreen');
    const endScreen = document.getElementById('endScreen');
    const pauseScreen = document.getElementById('pauseScreen'); 
    const usernameInput = document.getElementById('usernameInput'); 
    const endUsernameInput = document.getElementById('endUsernameInput'); 
    const confirmScoreBtn = document.getElementById('confirmScoreBtn'); 
    
    const playerSize = 40;
    const initialThrustSpeed = 8; 
    const maxVelocity = 15; 
    const OBSTACLE_HEIGHT = 30; 
    const minGapWidth = 80; 
    const maxGapWidth = 150; 
    const initialObstacleMoveSpeed = 2; 
    
    const POWERUP_SIZE = 25; 
    const POWERUP_DURATION = 5000; 
    const POWERUP_SPAWN_INTERVAL = 15000; 

    const HORIZONTAL_OSCILLATION_SPEED = 1; 
    const MAX_OSCILLATION_RANGE = 200; 

    const LEADERBOARD_KEY = 'fallingGameHighScores'; 
    const MOVEMENT_KEYS = ['ArrowLeft', 'ArrowRight', 'KeyA', 'KeyD', 'ArrowUp', 'ArrowDown', 'KeyW', 'KeyS'];
    
    // Tema verileri (renkler artık sadece engel için yedek olarak var, arkaplan resim kullanacak)
    const themes = [
        { name: "NEBULA 1", obstacleColor: "#5D6D7E" }, 
        { name: "MARS 2", obstacleColor: "#E74C3C" }, 
        { name: "JUPITER 3", obstacleColor: "#F1C40F" }, 
        { name: "NEPTUNE 4", obstacleColor: "#3498DB" }, 
        { name: "VULCAN 5", obstacleColor: "#9B59B6" }, 
        { name: "TITAN 6", obstacleColor: "#1ABC9C" }, 
        { name: "SATURN 7", obstacleColor: "#D35400" }, 
        { name: "GANYMEDE 8", obstacleColor: "#2C3E50" }, 
        { name: "URANUS 9", obstacleColor: "#ECF0F1" }    
    ];

    let currentThrustSpeed = initialThrustSpeed; 
    let currentObstacleMoveSpeed = initialObstacleMoveSpeed;
    let obstacleSpawnInterval = 1500; 
    let playerPosX; 
    let playerPosY; 
    let velocityX = 0; 
    let velocityY = 0; 
    let score = 0;
    let isGameOver = true; 
    let isPaused = false; 
    let gameInteractionStarted = false; 
    let keys = {}; 
    let startTime = 0;
    let timerInterval;
    let animationFrameId;
    let lastObstacleSpawnTime = 0;
    let lastPowerupSpawnTime = 0; 
    let obstacles = []; 
    let currentLevel = 0; 
    let currentObstacleColor = themes[0].obstacleColor; 
    let isPowerupActive = false; 
    let powerupPos = { x: -100, y: -100 }; 
    let latestUsername = "Anonim"; 
    
    // --- Oyun Kontrol Fonksiyonları ---
    
    function getHighScores() {
        const scores = localStorage.getItem(LEADERBOARD_KEY);
        return scores ? JSON.parse(scores) : [];
    }
    function saveScore(username, score) {
        let scores = getHighScores();
        const newScore = { username, score, date: new Date().toLocaleString() };
        scores.push(newScore);
        scores.sort((a, b) => b.score - a.score);
        scores = scores.slice(0, 10); 
        localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(scores));
    }
    function showLeaderboard(latestUsername) {
        const scores = getHighScores();
