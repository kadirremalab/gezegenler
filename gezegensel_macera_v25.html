<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Yer Çekimsiz Gezegen Macerası — Meteor Kaçış (Fix)</title>
<style>
  :root{ --player-size: 48px; --meteor-size: 34px; --ui-padding:10px }
  html,body{height:100%;}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#111;color:#fff;overflow:hidden}
  #gameContainer{position:relative;width:100vw;height:100vh;background-size:cover;background-position:center}
  #player{position:absolute;width:var(--player-size);height:var(--player-size);border-radius:50%;background:radial-gradient(circle,#ffd54f,#ff7043);box-shadow:0 0 18px rgba(255,112,67,0.6);touch-action:none;display:flex;align-items:center;justify-content:center;font-weight:bold}
  .meteor{position:absolute;border-radius:50%;background:linear-gradient(135deg,#666,#222);box-shadow:0 6px 18px rgba(0,0,0,0.6);}
  .ui{position:absolute;padding:var(--ui-padding);background:rgba(0,0,0,0.4);border-radius:8px;font-size:14px}
  #scoreBox{left:12px;top:12px}
  #timeBox{right:12px;top:12px}
  .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:200}
  .hidden{display:none}
  .btn{padding:10px 16px;border-radius:8px;border:none;background:#2ecc71;color:white;font-size:16px;cursor:pointer}
  #touchPad{position:absolute;bottom:12px;left:12px;width:120px;height:120px;border-radius:12px;background:rgba(0,0,0,0.25);display:flex;align-items:center;justify-content:center;z-index:150}
  #touchPad .stick{width:50px;height:50px;border-radius:50%;background:rgba(255,255,255,0.08)}
  @media(min-width:700px){#touchPad{display:none}}
</style>
</head>
<body>
<div id="gameContainer">
  <div id="startOverlay" class="overlay">
    <div style="text-align:center;max-width:420px">
      <h1>Yer Çekimsiz — Meteor Kaçış</h1>
      <p>Kontrol: 360° serbest hareket (ok tuşları / WASD / mobilde sürükle). Meteorlardan kaç — çarparsan oyun biter.</p>
      <p>Her 10 skor seviyesinde arka plan değişir.</p>
      <button id="startBtn" class="btn">Başlat</button>
    </div>
  </div>

  <div id="endOverlay" class="overlay hidden">
    <div style="text-align:center;max-width:420px;color:#fff">
      <h2>Oyun Bitti</h2>
      <p>Skorun: <span id="finalScore">0</span></p>
      <p>Süre: <span id="finalTime">00:00</span></p>
      <input id="nameInput" placeholder="Kullanıcı adı" style="padding:8px;border-radius:6px;border:none;margin-bottom:8px;width:80%" />
      <div style="display:flex;gap:8px;justify-content:center">
        <button id="saveBtn" class="btn">Kaydet</button>
        <button id="replayBtn" class="btn" style="background:#e74c3c">Tekrar</button>
      </div>
      <h3 style="margin-top:12px">Top 10</h3>
      <ul id="leader" style="text-align:left;max-height:160px;overflow:auto;padding:0 12px"></ul>
    </div>
  </div>

  <div id="scoreBox" class="ui">Skor: <span id="score">0</span></div>
  <div id="timeBox" class="ui">Süre: <span id="timer">00:00</span></div>

  <div id="player">●</div>
  <div id="touchPad"><div class="stick" id="stick"></div></div>
</div>

<script>
// === MEGA SÜRÜM: TÜM EFEKTLER EKLENDİ ===
recalcSizes();

let playerPosX = window.innerWidth/2;
let playerPosY = window.innerHeight/2;
let velocityX = 0, velocityY = 0;
let score = 0;
let isGameOver = true;
let keys = {};
let animationFrameId;

// === POWER-UP DURUMLARI ===
let shieldActive = false;
let speedBoostActive = false;
let invisibilityActive = false;

// === POWER-UP SÜRELERİ ===
const SHIELD_DURATION = 6000;
const SPEED_DURATION = 5000;
const INVIS_DURATION = 4500;

// === METEOR SİSTEMİ ===
let meteorList = [];
let lastMeteorTime = 0;
let METEOR_INTERVAL = 900;
const METEOR_BASE_SIZE = 45;

// === BLACK HOLE ===
let blackHole = null;
let BH_SPAWN_INTERVAL = 15000;
let lastBlackHole = 0;

// === EXPLOSION SPRITE ===
function spawnExplosion(x,y){
  const boom = document.createElement('div');
  boom.style.position='absolute';
  boom.style.left=x+'px';
  boom.style.top=y+'px';
  boom.style.width='80px';
  boom.style.height='80px';
  boom.style.background="url('explosion.gif') center/cover";
  boom.style.pointerEvents='none';
  gameContainer.appendChild(boom);
  setTimeout(()=>boom.remove(),500);
}

// === STAR TRAIL ===
function spawnTrail(){
  const t = document.createElement('div');
  t.style.position='absolute';
  t.style.width='6px';
  t.style.height='6px';
  t.style.borderRadius='50%';
  t.style.background='white';
  t.style.left=(playerPosX+playerSize/2)+'px';
  t.style.top=(playerPosY+playerSize/2)+'px';
  t.style.opacity='0.8';
  t.style.transition='opacity 0.6s linear';
  gameContainer.appendChild(t);
  setTimeout(()=>{ t.style.opacity='0'; },20);
  setTimeout(()=>t.remove(),700);
}

// === BLACK HOLE CREATION ===
function spawnBlackHole(){
  const bh = document.createElement('div');
  bh.style.position='absolute';
  bh.style.width='120px';
  bh.style.height='120px';
  bh.style.background="url('blackhole.png') no-repeat center/cover";
  bh.style.left = Math.random()*(window.innerWidth-120)+'px';
  bh.style.top = Math.random()*(window.innerHeight-120)+'px';
  bh.style.filter='drop-shadow(0 0 20px purple)';
  gameContainer.appendChild(bh);
  blackHole = { element:bh, x:parseFloat(bh.style.left), y:parseFloat(bh.style.top) };
}

// === BLACK HOLE GRAVITY ===
function applyBlackHoleGravity(){
  if(!blackHole) return;
  const dx = (blackHole.x+60) - (playerPosX+playerSize/2);
  const dy = (blackHole.y+60) - (playerPosY+playerSize/2);
  const dist = Math.sqrt(dx*dx + dy*dy);
  if(dist < 250){
    velocityX += dx/dist * 0.4;
    velocityY += dy/dist * 0.4;
  }
  if(dist < 70 && !shieldActive){ gameOver(); }
}

// === POWER-UP OLUŞTURMA ===
function spawnPowerUp(){
  const types = ['shield','speed','inv'];
  const pick = types[Math.floor(Math.random()*types.length)];
  const p = document.createElement('div');
  p.className = 'powerup';
  p.dataset.type = pick;
  p.style.position='absolute';
  p.style.width='35px';
  p.style.height='35px';
  p.style.left = Math.random()*(window.innerWidth-40)+'px';
  p.style.top = Math.random()*(window.innerHeight-40)+'px';
  p.style.background = pick==='shield' ? "cyan" : pick==='speed' ? "yellow" : "violet";
  p.style.borderRadius='50%';
  p.style.boxShadow='0 0 12px white';
  gameContainer.appendChild(p);
  setTimeout(()=>p.remove(),8000);
}
let lastPowerUp = 0;

// === POWER-UP ETKİLERİ ===
function activatePowerUp(type){
  if(type==='shield'){
    shieldActive = true;
    player.style.boxShadow='0 0 20px cyan';
    setTimeout(()=>{ shieldActive=false; player.style.boxShadow=''; }, SHIELD_DURATION);
  }
  if(type==='speed'){
    speedBoostActive = true;
    setTimeout(()=> speedBoostActive=false, SPEED_DURATION);
  }
  if(type==='inv'){
    invisibilityActive = true;
    player.style.opacity='0.35';
    setTimeout(()=>{ invisibilityActive=false; player.style.opacity='1'; }, INVIS_DURATION);
  }
}

// === METEOR SPAWN ===
function spawnMeteor(){
  const type = Math.random();
  let size = METEOR_BASE_SIZE;
  let speed = 4 + Math.random()*3;
  let img = 'meteor.png';

  if(type < 0.2){ size*=2; speed*=0.7; img='meteor_big.png'; }
  else if(type > 0.75){ size*=0.6; speed*=1.35; img='meteor_small.png'; }

  const meteor = document.createElement('div');
  meteor.style.position='absolute';
  meteor.style.width=size+'px';
  meteor.style.height=size+'px';
  meteor.style.background=`url('${img}') center/cover`;
  meteor.style.filter='drop-shadow(0 0 10px orange)';
  meteor.style.left=Math.random()*(window.innerWidth-size)+'px';
  meteor.style.top='-80px';

  const angle = (Math.random()*0.6) - 0.3;

  gameContainer.appendChild(meteor);
  meteorList.push({ element:meteor, vx:angle, vy:speed, x:parseFloat(meteor.style.left), y:-80, size });
}

// === GAME LOOP ===
function update(){
  if(isGameOver) return;

  // Star trail
  spawnTrail();

  // Black hole spawn
  if(Date.now() - lastBlackHole > BH_SPAWN_INTERVAL){
    spawnBlackHole();
    lastBlackHole = Date.now();
  }
  applyBlackHoleGravity();

  // Power-up spawn
  if(Date.now() - lastPowerUp > 7000){
    spawnPowerUp();
    lastPowerUp = Date.now();
  }

  // Player movement
  let speed = speedBoostActive ? 10 : 6;

  if(keys['ArrowLeft']||keys['KeyA']) velocityX = -speed;
  else if(keys['ArrowRight']||keys['KeyD']) velocityX = speed;
  else velocityX = 0;

  if(keys['ArrowUp']||keys['KeyW']) velocityY = -speed;
  else if(keys['ArrowDown']||keys['KeyS']) velocityY = speed;
  else velocityY = 0;

  playerPosX += velocityX;
  playerPosY += velocityY;

  if(playerPosX < 0) playerPosX = 0;
  if(playerPosX > window.innerWidth - playerSize) playerPosX = window.innerWidth - playerSize;
  if(playerPosY < 0) playerPosY = 0;
  if(playerPosY > window.innerHeight - playerSize) playerPosY = window.innerHeight - playerSize;

  player.style.left=playerPosX+'px';
  player.style.top=playerPosY+'px';

  // Meteor spawn
  if(Date.now()-lastMeteorTime > METEOR_INTERVAL){
    spawnMeteor();
    lastMeteorTime = Date.now();
  }

  // Meteor movement + collision
  for(let i=0;i<meteorList.length;i++){
    const m = meteorList[i];
    m.x+=m.vx;
    m.y+=m.vy;
    m.element.style.left=m.x+'px';
    m.element.style.top=m.y+'px';

    if(m.x < playerPosX+playerSize && m.x+m.size > playerPosX && m.y < playerPosY+playerSize && m.y+m.size > playerPosY){
      if(shieldActive){
        spawnExplosion(m.x,m.y);
        m.element.remove(); meteorList.splice(i,1); i--; continue;
      }
      if(!invisibilityActive){ gameOver(); return; }
    }

    if(m.y > window.innerHeight){
      m.element.remove(); meteorList.splice(i,1); i--;
      score++;
      document.getElementById('scoreValue').textContent=score;
      METEOR_INTERVAL = Math.max(350, 900 - score*12);
    }
  }

  // Power-up collision
  document.querySelectorAll('.powerup').forEach(p=>{
    const px = parseFloat(p.style.left);
    const py = parseFloat(p.style.top);
    if(px < playerPosX+playerSize && px+35 > playerPosX && py < playerPosY+playerSize && py+35 > playerPosY){
      activatePowerUp(p.dataset.type);
      spawnExplosion(px,py);
      p.remove();
    }
  });

  animationFrameId=requestAnimationFrame(update);
}

// === GAME CONTROL ===
function startGame(){
  score=0;
  isGameOver=false;
  meteorList.forEach(m=>m.element.remove());
  meteorList=[];
  if(blackHole){ blackHole.element.remove(); blackHole=null; }

  playerPosX=window.innerWidth/2;
  playerPos
</body>
</html>
